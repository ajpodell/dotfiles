#!/bin/bash

# a basic setup script for starting up a new mac

# TODO: make this optional, since want to have linux or mac compatible

# -- all of this should be mac only --

echo "looking for homebrew"
which -s brew
if [[ $? != 0  ]] ; then
    echo "installing homebrew";
    ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
else
    echo "updating homebrew"
    brew update
fi

echo "instaling git-completion script"
curl https://raw.githubusercontent.com/git/git/master/contrib/completion/git-completion.bash -o ~/.git-completion.bash

# should check that dotpath is in place - but just do it now
if [ ! -n "$DOTPATH" ] ; then
    echo "setting DOTPATH"
    export DOTPATH=$HOME/dotfiles
else
    echo "DOTPATH already set"
fi


# install xcode command line tools if not installed
# xcode-select --install

# ------ END MAC STUFF ------


# TODO: add a thing if dotpath doesnt exit - bail now. echo you gotta source the bashrc

# create top-level files --- TODO these should be more like an append. and ideally it would take in the appropriate file, since bashrc or bash_profile or .bashrc.user could be used
# NOTE
# inputrc is handled by a path variable in the bashrc
if [ ! -f $HOME/.tmux.conf ]; then
    echo "adding .tmux.conf"
    echo "source-file $DOTPATH/.tmux.conf" > $HOME/.tmux.conf
fi
#############################
#########    ZSH    #########
#############################
# Create zshrc
if [ ! -f $HOME/.zshrc ]; then
    echo "adding .zshrc"
    echo "source $DOTPATH/.zshrc" > $HOME/.zshrc
fi
which starship
if [[ $? != 0 ]] ; then
    echo "starship not found, installing"
    brew install starship
else
    echo "starship already installed"
fi
which fzf
if [[ $? != 0 ]] ; then
    echo "fzf not found, installing"
    brew install fzf
else
    echo "fzf already installed"
fi
which fd
if [[ $? != 0 ]] ; then
    echo "fd not found, installing"
    brew install fd
else
    echo "fd already installed"
fi



# if [ ! -f $HOME/.bash_profile ]; then
#   echo "adding .bash_profile"
#     echo "source $DOTPATH/.bashrc" > $HOME/.bash_profile
# fi

#############################
#########    VIM    #########
#############################
echo "vim setup:"
which nvim
if [[ $? != 0 ]] ; then
    echo "nvim not found, installing"
    brew install neovim
fi

if [ ! -f $HOME/.vimrc ]; then
    echo "adding .vimrc"
    echo "source $DOTPATH/.vimrc" > $HOME/.vimrc
fi

echo "dont forget to add a nerdfont - like hack nerdfont - then set to your profile in iterm"

# for using neovim
# create a file:
# ~/.config/nvim/init.vim (that will be like your .vimrc, youâ€™ll paste all your custom config at this file)
#that file should have the following to just leave .vimrc as config

# set runtimepath^=~/.vim runtimepath+=~/.vim/after
# let &packpath = &runtimepath
# source ~/.vimrc
if [ ! -f $HOME/.config/nvim/init.vim ]; then
    mkdir -p $HOME/.config/nvim && touch $HOME/.config/nvim/init.vim
    printf "set runtimepath^=~/.vim runtimepath+=~/.vim/after\nlet &packpath = &runtimepath\nsource ~/.vimrc" >> $HOME/.config/nvim/init.vim
fi

# install vundle
echo "looking for vundle";
if [ ! -d $HOME/.vim/bundle/Vundle.vim ]; then
    echo "installing vundle"
    git clone -q https://github.com/VundleVim/Vundle.vim.git ~/.vim/bundle/Vundle.vim;
    # go to  ~/dotfiles/.vim.plugins and :PluginInstall
else
    echo "vundle already installed"
fi


#############################
#########    GIT    #########
#############################
# Create the gitconfig mapping
if [ ! -z "$(grep "dotfiles/.gitconfig" "$HOME/.gitconfig")" ]; then
    echo "gitconfig already configured"
else
    echo "adding dotfiles gitconfig to gitconfig path"
    echo -e "[include]\n\tpath = ~/dotfiles/.gitconfig" >> $HOME/.gitconfig
fi



#############################
########    PYTHON    #######
#############################
# inputrc doesnt work in ipython & ipdb
# run `ipython profile create`
# ```
# set the following
## Shortcut style to use at the prompt. 'vi' or 'emacs'.
#  Default: 'emacs'
# c.TerminalInteractiveShell.editing_mode = "vi"

## Set the editor used by IPython (default to $EDITOR/vi/notepad).
#  Default: 'nvim'
# c.TerminalInteractiveShell.editor = "nvim"
# ```
# theres more i havent explored

# vim: ft=sh
